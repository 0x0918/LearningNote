# 源码解读1
所有的函数都继承了两个类，要么`copyable`，要么`nocopyable`。  

`nocopyable`只需要让其拷贝构造函数和赋值构造函数定义为`=delete`即可(c++11特性)或者将其定义为`private`。其默认构造函数和析构函数需要定义为`protectd`，使得只能为子类使用，但是子类不具有复制行为。
```cpp
    class noncopyable {
        public:
        noncopyable(const noncopyable&) = delete;
        void operator=(const noncopyable&) = delete;

        protected:
        noncopyable() = default;
        ~noncopyable() = default;
    };
```
### 1. `TimeStamp`
+ `PRId64`实现`int64`的跨平台   
    `int64`在32/64不同的系统上，表示不同，linux上定义如下：
    ```cpp
        #if     __WORDSIZE == 64    // 64位机器 
        #define __PRI64_PREFIX	"l" 
        #else                       // 32位机器
        #define __PRI64_PREFIX	"ll"
        #endif
        // 因此在64位的机器上是 ld,32位机器上是lld
        #define PRId64		__PRI64_PREFIX "d"
    ```
    在如下的格式化代码中，通过`PRI64`实现跨平台
    ```cpp
    string Timestamp::toString() const {
        char buf[32] = {0};
        int64_t seconds = microSecondsSinceEpoch_ / kMicroSecondsPerSecond;   // 整数
        int64_t microseconds = microSecondsSinceEpoch_ % kMicroSecondsPerSecond;  // 余数
        snprintf(buf, sizeof(buf)-1, "%" PRId64 ".%06" PRId64 "", seconds, microseconds);
        return buf;
    }
    ```
### 2. `Atomic`
+ `gcc`的原子操作
    + `__sydnc_val_compare_and_swap(type* ptr, type oval, type nval)`    
    原子比较交换操作：`*ptr* = *ptr==oval? nval : *ptr`。返回的是没有修改过的`*ptr`。
    + `__sync_fetch_and_add(type* ptr, type value)`  
    原子增加操作：`value + x`，并且返回修改之前的`value`。
    + `__sync_lock_test_and_set(type* ptr, type value)`  
    原子赋值操作：`*ptr=value`
+ `volatile`  
  `volatile` 关键字是为了确保本指令不会因为编译器的优化而省略，且要求每次直接读值。即：防止编译器对代码进行优化。

  当要求使用 `volatile` 声明的变量的值的时候，系统总是重新从它所在的内存读取数据，而不是使用保存在寄存器中的备份。

+ `gcc`编译时选项
    ```cpp
         Wall			// 大部分警告 
        -Wextra			// 一些额外的警告
        -Werror			// 当出现警告时转为错误，停止编译
        -Wconversion		    // 一些可能改变值的隐式转换，给出警告。
        -Wno-unused-parameter	// 函数中出现未使用的参数，不给出警告。
        -Wold-style-cast		// C风格的转换，给出警告
        -Woverloaded-virtual	// 如果函数的声明隐藏住了基类的虚函数，就给出警告。
        -Wpointer-arith		// 对函数指针或者void *类型的指针进行算术操作时给出警告
        -Wshadow		    // 当一个局部变量遮盖住了另一个局部变量，或者全局变量时，给出警告。
        -Wwrite-strings		// 规定字符串常量的类型是const char[length],因此,把这样的地址复制给 non-const char *指针将产生警告.这些警告能够帮助你在编译期间发现企图写入字符串常量 的代码
        -march=native		// 指定cpu体系结构为本地平台
    ```